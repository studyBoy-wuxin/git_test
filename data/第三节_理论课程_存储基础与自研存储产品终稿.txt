存储基础与自研存储产品课程开发小组：林志銮、朱伟、刘伟林、张育、顾佩彬、贾水军课程简介目标学员：

1、云网支撑工程师

2、产品支撑经理

3、客户工程师

4、解决方案经理前提要求：

1、具备IT基本技能

2、具备IP网基础知识技能课程收获：

1、掌握存储技术基本概念与演进

2、掌握存储备份与容灾的基本原理

3、掌握分布式存储原理及应用

4、掌握天翼云自研存储产品

5、掌握天翼云存储实操

6、了解存储相关解决方案及案例课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例

1.1数据存储狭义的存储定义广义的存储定义

一、什么是数据存储存储设备磁盘阵列磁带库虚拟磁带库......连接设备HBA卡交换机连接线缆......容灾解决方案备份解决方案存储管理软件快照、镜像软件备份软件多路径软件解决方案存储硬件存储软件

1.1数据存储

二、数据存储系统

三、数据存储分类存储外置存储DASFASSAN（块）NAS（文件）内置存储

1.1数据存储

四、数据存储的应用文件服务器离线存储数据产生数据处理数据管理数据库服务器邮箱服务器应用服务器用户员工在线存储近线存储依据数据的访问频率

1.1数据存储

二、从硬盘到磁盘阵列CPURAM硬盘服务器JBODCPURAM硬盘服务器CPURAM硬盘服务器控制器硬盘在服务器内部早期外挂存储存储阵列

1.2存储技术的发展-存储架构

三、从分离到融合NASLAN服务器存储阵列文件系统网络附加存储SAN服务器存储阵列文件系统存储区域网络服务器存储阵列文件系统以太网用户端统一存储SAN

1.2存储技术的发展-存储架构

四、存储虚拟化⚫存储虚拟化可以将存储设备进行抽象，以逻辑资源的方式呈现，统一提供全面的存储服务。⚫可以在不同的存储形态或设备类型之间提供统一的功能。逻辑表现管理客户端或服务器虚拟化物理资源

1.2存储技术的发展-存储架构

五、云存储⚫云存储系统是一个多存储设备、多应用、多服务协同工作的集合体，它使用高度虚拟化的多租户基础设施为企业提供可扩展的存储资源，可以根据组织的要求动态配置。融合弹性开放新型应用传统应用对象存储服务文件存储服务块存储服务存储设备与存储节点通用硬件平台协议与接口

1.2存储技术的发展-存储架构

一、机械硬盘发展简史⚫容量越来越大，体积越来越小。1950s-1960s巨型硬盘1960s-1970s14寸硬盘1970s-1980s8寸硬盘1980s-1990s轻便便携1990s-微硬盘IBM350RAMACIBM1301IBM3340硬盘开始进入民用市场

5.25寸

3.5寸

2.5寸

1.8寸日立：1英寸东芝：0.85英寸......

1.2存储技术的发展-存储介质•贝尔实验室•浮栅晶体管1967年1976年•Dataram出售BulkCore•2MB容量•SanDisk推出FlashSSD•20MB容量1991年1999年•BiTMICRO推出FlashSSD•18GB容量•三星发布固态硬盘笔记本•32GB容量2006年2010年...•成本不断降低•容量不断提升

二、固态硬盘发展简史⚫⚫固态硬盘出现也很早，但是因为20世纪末机械硬盘快速发展而被遗忘。但随着对存取速度要求的提高，固态硬盘又开始繁荣发展。

1.2存储技术的发展-存储介质

一、接口协议⚫⚫硬盘接口是硬盘与主机系统间的连接部件。接口协议（InterfaceProtocol）指的是需要进行信息交换的接口间需要遵从的通信方式和要求。并行接口IDE串行接口SATA

1.2存储技术的发展-接口协议

二、接口协议发展简史2004200820122016201720184GFC2020...主机接口硬盘接口SAS

2.0SAS

3.0SAS

4.0NVMe

1.0NVMe

1.2NVMe

1.3SATA

1.0NVMe

1.4SATA

3.08GFC16GFC32GFC64GFCNVMe-oF

1.0(RDMA)NVMe-oF(FC-NVMe)NVMe-oF

1.1(TCP)iSCSI2GFC4GFCSAS

1.0SATA

2.01994年，第一代FC协议发布100GEthernet400GEthernet

1.2存储技术的发展-接口协议

三、NVMe与NVMe-oF⚫NVMe,Non-VolatileMemoryExpress提升性能降低时延⚫NVMe-oF,NVMeoverFabrics潜力：低延迟，高带宽目的：加速服务器主机和目标存储设备之间的数据传输NVMe后端物理路径CPUPCIe

1.2存储技术的发展-接口协议

一、存储产品发展历程智能化闪存化云化趋势磁盘闪存介质集中式分布式架构人工运维智能运维管理

1.2存储技术的发展-存储产品

二、智能时代对数据存储的新要求金融运营商大企业政府&公共交通硬盘故障率高多点故障业务中断大并发时延波动大能源&电力块/文件/对象服务融合不高效RAID重构时间长数据重删压缩率低7X24小时万物互联，业务不间断运行微秒级5G时代，生产交易实时高速处理EB级数据资产化，存储智能分层，冷变温挖掘价值高可靠高性能高容量高效率降低TCO边，中心，云协同，让数据每比特成本最低，价值最大

1.2存储技术的发展-存储产品现状FCSAN/IPSAN独立两张网未来AIFabric融合网络网络成本高：FC专网时延低，价格昂贵；IPSAN成本低，但时延和性能略差运维代价高：IP/FCSAN短期无法融合，需要专人运维，且无法云网协同降低网络成本：开放以太网承载高性能低时延低成本的存储网络降低运维成本：无需专用技能运维，支持数据中心统一网络管理iNICiNICEthernet无丢包低时延灵活FCSANLANEth10GEth16GFCSAN10GIPSANNICFCSANIPSAN低时延灵活NICFCSANIPSANIPSAN低成本

三、存储网络发展趋势

1.2存储技术的发展-存储产品存储技术基本概念与演进

1.1数据存储

1.2存储技术的发展本章总结数据存储概念数据存储系统存储的物理结构数据存储分类与应用存储架构存储介质接口协议存储产品课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例先从每个人的生活说起22现状问题生活中每个人基本上每天无时无刻不在做着云灾备，请看看以下这些场景：苹果手机：自动上传所有照片和视频，并安全地存储在icloud中，老是提醒空间已满百度网盘：相册视频自动备份，再也不怕丢照片了QQ同步助手：云端自动备份通信录，再也不怕误删手机号了

2.1备份和容灾基础知识-背景意义天翼云•安全云大大小小的灾难故障，没有一个地方是绝对安全的企业为什么要做灾备？24现状IT系统问题服务器、应用程序、硬件操作系统、数据库、虚拟机等故障网络安全技术问题网络/病毒攻击、数据窃取/丢失、篡改、加密、泄露信息安全管理问题人为误操作、rm-rf/*删除、升级失败，无灾备演练、供应商过失灾害类事件地震、洪灾、火灾、雷电、战争、城市建设数据和业务面临的各类问题对很多企业而言，数据就是核心资产业务出现不连续就是巨大的经济损失容灾备份产品的最终目标是帮助企业应对人为误操作、软件错误、病毒入侵等“软”性灾害以及硬件故障、自然灾害等“硬”性灾害。灾备行业合规性要求已上升到国家法规层面，以网络安全法为例，已于2019年12月1日全国正式实施目前网络安全等级保护

2.0标准，其中专门有数据备份与恢复条款。重要卫生信息系统安全保护等级原则上不低于第三级备份：备份是容灾的基础，通常指在数据中心内，将全部或部分数据集合从应用主机的硬盘或阵列复制到其它的存储介质的过程。备份是为了应对灾难来临时造成的数据丢失问题容灾：是指在相隔较远的异地，建立两套或多套功能相同的IT系统，互相之间可以进行健康状态监视和功能切换，当一处系统因意外(如火灾、地震等)停止工作时，整个应用系统可以切换到另一处，使得该系统功能可以继续正常工作。OSAPPOSAPPOSAPPOSAPPOSAPPOSAPP业务应用数据DC1DC2数据库文档操作系统应用程序硬盘光盘磁带打包的备份集灾备是两个词备份和容灾的统称，在容灾备份一体化产品之前相互独立。备份关注数据可恢复性；容灾关注的是业务的连续性。备份容灾

2.1备份和容灾基础知识-什么是灾备27RTO(RecoveryTimeObjective)可以承受的最长停机时间RTO(RecoveryTimeObjective)可以承受的最长停机时间应用恢复启动恢复完成恢复备份完成RPORPO故障/灾难发生00:0006:0012:00备份开始RPO(RecoveryPointObjective)可以承受的最大数据丢失量RPO(RecoveryPointObjective)可以承受的最大数据丢失量BW(BackupWindow)一个工作周期内留给备份系统进行备份的时间长度BW(BackupWindow)一个工作周期内留给备份系统进行备份的时间长度RTORTOBWBW故障发生后数据可以恢复到的时间点故障发生后数据可以恢复到的时间点灾备系统三要素：BW、RPO、RTO

2.1备份和容灾基础知识-灾备要素三种备份策略对比备份策略：全量备份、增量备份、差异备份记忆口诀：增量是从最新增，不重复；差异是从全备增，会重复。

2.1备份和容灾基础知识-备份策略四种备份传输方式：LAN-Base（备份走LAN）LAN-Free（备份走SAN）Server-Free（经过备份服务器）Server-less（不经过备份服务器）

2.1备份和容灾基础知识-备份方式本地容灾——一般指主机集群，当某台主机出现故障，不能正常工作时，其他的主机可以替代该主机，继续进行正常的工作。异地容灾——一般指在与生产机房有一定距离的异地建立与生产机房类似的信息平台（备份中心），并采用特定的技术将生产中心的数据传输到该备份中心，从而在生产中心发生较大的灾难如火灾或地质灾害时，仍能对生产数据进行保护的容灾系统。云容灾——一般指云数据中心的物理机或虚拟机容灾。云主机系统由大量服务器组成并分布在不同的地点，同一时间为大量用户服务，因此云计算系统采用分布式存储的方式存储数据，用冗余存储的方式（集群计算、数据冗余和分布式存储）保证数据的可靠性。这种方式保证分布式数据的高可用、高可靠和经济性，即为同一份数据存储多个副本。本地容灾异地容灾云容灾公有云存储中心公有云存储中心本地生产数据中心同城双活数据中心异地数据中心两地三中心

2.1备份和容灾基础知识-容灾分类（距离来分）容灾的分类数据灾备业务灾备关注点是数据，数据恢复是最底层，RTO大，若干天较低级别的数据容灾方案利用备份软件即可实现较高级别的数据容灾方案依靠网络的数据复制工具数据必须完整一致后数据库才能启动，之后才是启动应用程序，应用服务器接管完成后，才能进行网络的切换关注点是应用的具体功能接管，RTO中，若干小时提供可持续的应用数据复制灾难发生时，应用服务请求自动切换，对于用户是透明的最高级别的方案，RTO小，若干分钟或秒除了为IT业务系统提高容灾，还包括一系列非IT系统应用灾备灾备大体可以分为三个等级，从数据级灾备、应用级灾备到业务级灾备，业务恢复等级逐步提高，而需要的投资费用也相应增长。

2.1备份和容灾基础知识-灾备等级实现进程数据实时备份，实现零丢失应用软件可以实现实时无缝切换进程集群系统的实时监控和自动切换能力实现进程数据复制技术备用网络也具备自动集中切换能力数据零丢失和进程集群支持6级5级实时数据传输及完整设备支持电子传输及完整设备支持配置所需要的全部数据和通讯线路及网络设备，并处于就绪状态7*24运行;更高的技术支持和运维管理4级电子传输和部分设备支持3级2级备用场地支持基本支持配置部分数据,通信线路和网络设备每天实现多次的数据电子传输备用场地配置与职的运行管理人员预定时间调配数据,通信线路和网络设备备用场地管理制度设备及网络紧急供货协议每周至少做一次完全数据备份制定介质存取、验证和转储的管理制度完整测试和演练的灾难恢复计划1级

322.1备份和容灾基础知识-灾备系统国内标准灾备标准对应的灾备等级、RTO、RPO国内灾备标准灾备等级RTORPO1级机房内备份方案2天以上1天至7天2级机房外备份方案24小时以后1天至7天3级异地备份方案12小时以后数小时至1天4级数据级容灾方案数小时至2天数小时至1天5级数据级容灾方案+容灾应用软件数分钟至2天0至30分钟6级应用级容灾数分钟033本节知识点小结端到端双活技术方案方案模块设计要点存储层存储层使用阵列的HM双活特性，在AB2个数据中心之间阵列做集群最终可实现2边数据双写的目标网络层打通大二层网络，保障了业务的跨数据中心互联互通。安全层提供数据中心的FW、IDS、WAF等安全防护功能。计算层采用华为FusionSphere、VMwareVsphere等虚拟化平台提供跨数据中心大集群技术，满足企业多种关键业务双活的需求。应用层

1.web和App应用基于虚拟化集群提供更好的可靠性，通过负载均衡实现业务自动切换。

2.数据库基于双活LUN实现跨站点集群双活部署。传输层采用DWDM或者裸光纤，通过线路冗余，满足多级可靠性要求。存储层双活：虚拟双活LUN36业务连续性的重要性越来越关注，而且人们的关注点也不再仅仅集中于前端主机的高可用，而是开始意识到作为数据服务基石——存储层业务连续性的重要性。端到端双活数据中心解决方案中最核心的技术当属存储双活技术网络层双活：大二层SDN技术37•通过SDN及VxLAN技术构建Overlay网络，实现主、备数据中心的大二层互通，实现网络访问路径自定义，实现网络资源的灵活调配。--机房双活场景下多业务接入--跨机房弹性扩展--虚拟机可以跨机房自由迁移，不用更改IP应用层双活：服务器集群(SLB集群)应用场景Web服务器/App服务器/中间件服务器应用无数据一致性要求提升应用性能，提升业务连续性SLB集群VIP供客户机或上层服务器访问通过NATServer地址转换分发流量服务器健康检测机制，检测应用状态根据应用健康状态，发布VIP特点访问流量全部经过SLB服务器间保持相对独立，无特殊互联要求健康检测SLB业务访问VIP1VIP1IP1IP2IP3IP4集群虚IP(VIP1)10.

1.

1.1SLB通常做网关(与实IP网段相同)分发流量服务器实IP

192.

168.

1.1~4源IP目的IP10.

2.

2.10010.

1.

1.1源IP目的IP10.

2.

2.100

192.

168.

1.110.

2.

2.100

192.

168.

1.210.

2.

2.100

192.

168.

1.3应用层双活：GSLB全局负载均衡适用场景采用SLB集群部署采用URL访问部署方式SLB+GSLB业务通过URL方式访问SLB与GSLB联动GSLB通过SLB对服务器健康检测，可以根据不同算法（如，就近访问或者应用Session连接数等）实现对不同数据中心的调度访问L3WAN/MANL3互联设备互联设备VLAN100VLAN100vSwitchVM1vSwitchVM3VM2IP:X.X.X.100远程园区/分支机构SLBVIP1SLBVIP2GSLB二层互联GSLB联动联动API联动解析VIP1解析VIP2API联动VM4本节知识点小结课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例42案例：***文件中台建设需求售楼系统、积分系统、合同管理系统、CRM系统、电子档案系统......所有系统的文件统一集中管理，便于共享，提升效率，同时需要严格的权限管理一年产生文件数量数十亿个文件，容量数百T，逐年递增要有较好的访问性能，同时成本严格控制诉求：

1、数据共享

2、精细的权限控制

3、海量非结构化数据

4、较好的访问性能

5、较低的成本问题：该场景适合使用什么类型的存储？思考存储的类型块存储文件存储对象存储存储有多种类型，当今最流行的存储类型包括块存储、文件存储和对象存储等。其中，对象存储是在云计算时代被广泛应用的一种新型的存储结构。43对象存储简介对象存储系统将底层的物理存储抽象成逻辑上的“对象”。“对象（object）”是这种存储系统中最基本的存储单元，它的主要组成成分是“元数据（Metadata）”和“数据（Data）”。元数据（Metadata）是对象的一组属性信息，而数据（Data）就是这个对象的内容本身。44对象存储的结构文件系统的存储结构对象存储的结构object45天翼云对象存储服务天翼云对象存储服务OOSWeb服务接口客户数据中心应用服务器数据库服务器天翼云对象存储服务提供基于天翼云平台的对象存储服务。它和大部分标准的云服务一样，通过标准的服务接口为用户提供服务。46对象存储的主要概念账户服务对象容器对象对象存储的主要概念有：Account（账户）、Service（服务）、Bucket（对象容器）、Object（对象）。它们之间的关系如下图所示：47对象存储高级功能-访问权限public（公有）private（私有）public-read（只读）读操作写操作对象存储的Bucket目前有3种访问权限，分别是：public（公有），private（私有），public-read（只读）。48对象存储高级功能-安全策略除了给Bucket设置访问权限，对象存储还支持安全策略（Policy）的配置。Policy的授权可以是Bucket级别，也可以是Object级别。通过配置Policy，可以限制访问源的IP和域名。49分布式存储出现的背景传统商业存储优点：

1、性能很好，非常稳定，可靠性强，出问题了有厂家支持缺点：

1、价格非常昂贵

2、不支持横向扩展

3、单点故障

4、难以支持对象存储

5、容量有限

6、服务器节点相对有限50分布式存储

1、存储服务跑在一个集群上，集群可以自由缩容扩容，单个节点故障不影响集群正常提供存储服务。（解决扩容及单点故障问题）

2、分布式存储软件直接运行在普通廉价服务器上。（解决成本问题）

3、通过增加节点，一方面增加存储容量，另一方面增加可提供服务的性能指标，包括IOPS、吞吐等。（解决容量及性能问题）

4、分布式存储直接提供文件、块、对象三个存储类型。（解决无法提供对象存储问题）

5、数据采用多副本及EC方案，实现数据高可用。（解决数据可用性问题）51分布式存储架构•计算集群–计算服务器：运行虚拟化软件/Docker，支持虚机/容器的运行–运行分布式存储系统客户端，使用存储服务•存储集群–存储服务器：常规服务器，10~20个磁盘插槽，每个磁盘2TB，单服务器20~40TB容量–运行分布式存储软件，管理磁盘，提供存储服务，例如文件/块读写52什么是cephCeph是一个开源存储软件，可运行在通用的x86服务器上，可提供对象、块、文件三种存储服务。Ceph是免费的，没有厂商锁定，可自由修改，创新。标签：

1、软件定义存储

2、统一存储（提供对象，块，文件三种服务）

3、可横向扩展的存储，可自由扩展是云计算时代对存储的基本要求

4、面向未来的存储

5、存储领域的linux53Ceph-提供可靠的存储服务Ceph在不可靠的组件（硬盘、主机，网线，交换机）之上建立了可靠的存储服务：

1、没有单点故障

2、通过复制和纠错码保障数据的高可用性

3、可采用纵向和横向扩展，提升集群的容量和性能Ceph社区目前重点关注的系统的稳定性和数据的一致性、正确性，未来会在性能方面进行优化提升。54Ceph部署55Ceph部署56Ceph57Ceph58Ceph59RADOSGW（RADOSGateway）提供对象存储网关服务，基于librados接口封装实现FastCGI服务–对外提供存储和管理对象的RESTful接口，兼容S3和SwiftAPI–RADOSGateway前端为HTTP服务器角色，接收并解析应用程序发送的RESTful请求•默认使用Civetweb（C++库，实现Web服务器功能）•支持Ngnix，Apache等主流Web服务器–RADOSGateway后端为RADOS集群客户端角色，通过librados、socket与RADOS集群交互Ceph60•RBD（RADOSBlockDevice，RBD）–提供块设备接口抽象，Ceph目前应用最广泛和稳定的形式–有lib和kernel两种形式Ceph—数据存放61–File->Objects->PGs–PG是数据的逻辑组织，不同PG绑定不同OSDCeph—数据存放EFS_PRIPROD_MIX_01_01共8192个PGEFS_PRIPROD_MIX_01_02共16384个PG一个OBJECT如何映射到PGhash(object_id,namespace)哈希算法：rjenkinsCeph64•物理层放置–CRUSH(pgid)->(osd.1,osd.

2.....osd.n)考虑因素–数据在存储节点上要尽量均匀分布–数据副本存储时要尽量做到故障隔离，即副本尽量避免同时失效–集群扩容或节点故障不要引起大规模数据迁移Ceph65•故障域（bucket）–基于故障域粒度进行故障隔离，例如故障域选择为host时，同一数据的多个副本应该放置在不同的host上–root是顶层节点，必须存在–Ceph中的故障域如下，实际使用时并不需要全部使用，根据实际拓扑选择PG如何映射到OSDCRUSH_HASH(PG_ID,bucket_ID,r)===>draw(draw&0xffff)*osd_weight===>osd_strawpickuphigh_osd_strawcrush算法核心，先利用固定输入得到随机数，随机数乘以权重，最后选择结果最大的节点。根据故障域设计，层层选择，最终得到固定数量的叶子节点（OSD）。根据PGID，计算出具体OSD的算法称为crush算法Ceph67Ceph68Ceph69defaultdefaultEBS_PRIPROD_MIX_01EBS_PRIPROD_MIX_01OSDOSDvrack3vrack3vrack2vrack2vrack1vrack1hosthosthosthosthosthostvrack4vrack4OSDOSDhosthostOSDOSDOSDOSDCeph70课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例软件架构云转型，天翼云自研存储产品应运而生传统架构软件云架构软件分布式存储产品政务交通能源生物电信本地存储物理机集中式数据库单体应用架构无冗余单一存储协议本地部署应用硬盘拷贝解耦合虚拟化分布式灾备安全云端存储虚拟机分布式云数据库微服务架构容灾备份方案多种协议容器部署对象迁移云硬盘对象存储文件存储云备份云容灾CSI容器存储云存储网关对象迁移72不同业务对应不同的存储需求数据库、虚拟化、云计算块大数据分析、云应用、备份归档对象文件共享、影像票据、HPCNAS73天翼云天翼云自研存储产品架构存储数据服务云硬盘镜像服务视频存储容器服务备份容灾归档存储数据库/RDS备份数据湖管理图形化界面一体化运维空间管理管理平台智能巡检性能监控故障告警块存储公有云基础能力文件存储对象存储容器存储基础服务分布式存储引擎系统存储引擎RPC通信组件分布式协同安全组件资源管理操作系统数据迁移在线迁移服务离线迁移服务IDC存储网关超融合存储混合云存储边缘存储多级缓存元数据管理数据放置数据校验麒麟统信UOSCTyunOS74天翼云自研存储产品优势自研架构极致性能兼容国产化智能运维全栈解决方案核心技术全部自主掌握，非开源二次；掌控在强一致性和可用性之间达到最佳平衡点的核心技术。自主可控兼容自研云操作系统；提供公私专混的信创云、国家云服务。极速体验单桶对象数量支持10亿+，时延10ms；单云盘IOPS可达50000，时延1ms；单文件系统IOPS可达20000，时延低至1ms。一站式管理30分钟一键式部署完成；可视化运维。内网优势安全专网与云主机天然内网互通，链路安全时延低；云主机备份、还原及文件业务等不产生公网流量。75天翼云自研存储产品规模及优势5GMEC/CDNIOTHUB/云POPX一省一池31京津冀长三角粤港澳川陕渝4内蒙园区贵州园区2大数据、AI训练、高性能计算、海量存储超大规模、超低成本云游戏、云VR等2C/2H集约业务规模化、低成本的公有云模式政务云、医疗云、教育云等2G/2B业务属地化专属云模式低时延、数据敏感、园区化等2B业务边缘云网一体化模式集中化区域化属地化边缘化冷数据温数据温数据就近读写，全网强一致，冷热平衡260PB块存储10PB文件存储66PB对象存储76天翼云自研存储产品-云硬盘77相对于传统的服务器硬盘，云硬盘具有更高的数据可靠性、更高的I/O吞吐能力，并且更加简单易用；可以为云主机提供高可靠、高性能、规格丰富的系统盘和数据盘，满足文件系统、数据库或者其他应用等的存储。用户可以在线操作及管理云硬盘，并可以像使用传统服务器硬盘一样，对挂载到云主机的磁盘做格式化、创建文件等。78天翼云自研存储产品-云硬盘支持扩容0~23块数据盘10G~32T（步长10G）天翼云云硬盘单块盘的容量可选范围是10G到32T，步长10G。如果在使用过程中，发现存储空间不够了，可以对系统盘、数据盘进行扩容。单台云主机可挂载0到多块数据盘，最多可以挂载23块。79天翼云自研存储产品-云硬盘按照功能的不同，可以将云硬盘分为系统盘和数据盘。80天翼云自研存储产品-云硬盘根据是否支持挂载至多台云主机可以将云硬盘分为非共享云硬盘和共享云硬盘。81天翼云自研存储产品-云硬盘Node1Node2Node3SharedStoragSharedRACnodeInterconnectOracleRAC云主机云主机云主机共享型云硬盘82天翼云自研存储产品-共享云硬盘云硬盘分类-普通IO&高IO&超高IO说明：最大IOPS和吞吐量必须在多台云主机同时使用共享云硬盘的场景下测量83不同性能云硬盘适用场景普通IO企业日常办公小型测试高IO企业应用大型开发测试Web服务器日志超高IO高性能计算分布式文件系统数据库84天翼云自研存储产品功能-云硬盘-架构云硬盘架构挂载至云服务器创建备份裸金属服务器弹性云主机创建快照云硬盘快照云硬盘备份创建新云硬盘恢复数据云硬盘灵活部署数据独立弹性扩展85天翼云自研存储产品功能-云硬盘-产品能力0103产品能力高并发/高可用无缝对接云主机/裸金属服务器；高并发、高带宽、无限扩展的iSCSI网关；支持异地同步/异步容灾（2022上线）。多适配性02规格丰富04安全可靠数据可靠性

99.9999999999%；支持KMS加密，应用无感知，安全便捷；支持秒级快照及云盘备份。普通I/O、高I/O；通用型SSD、超高I/O；SSD极速I/O（2022上线）。无缝对接云主机/裸金属服务器；兼容标准的OpenStack的块存储驱动；实现iSCSI透传支持对接OracleRACWindowsServer等核心集群应用；提供VAAI支持VMware的应用场景。86天翼云自研存储产品功能-云硬盘-功能010104040303云硬盘iSCSI•跨网关热迁移；•分布式PR锁；•VAAI（硬件加速）；•数据一致性校验；•安全服务（CHAP身份认证、ACL访问权限管理）。云硬盘备份/容灾•实时增量备份；•备份快速恢复；•备份配置方式可选；•备份安全；•异步容灾（2022上线）。云硬盘•快照创建、删除、回滚；•云盘创建、删除、查询；•IO智能管理、云盘加密、回收站；•拷贝、深度拷贝；•重命名。本地盘•vhost-user技术；•高性能用户态I/O；云硬盘功能020287天翼云自研存储产品功能-对象存储-架构标准存储低频存储归档存储AZ2AZ1AZ3AZ1AZ2AZ3Region1Region2NFS/CIFS/FTPS3SWIFT云主机裸金属CDNMapReduceSDR88天翼云对象存储的产品优势•分布式架构，支持资源灵活、无限扩展，应对业务实时变化•支持多路视频大流量高并发•按需使用，避免资源浪费弹性灵活•资源池位于中国电信骨干节点，并且预留充足带宽，轻松应对高峰及突发流量•可提供专线，满足网络延迟和安全等级要求快速高效•沉余系统设计，服务可用性达3个9，数据持久性达13个9•多种加密技术，保障数据安全•7×24远程监控与快速维护响应安全可靠•区域节点覆盖广，实现客户业务快速接入及部署•本地节点按需建设，满足客户属地化部署需求区域+属地部署89天翼云对象存储的产品计费模式按用户数据占用的存储空间量收取费用按用户存储数据被调用或下载产生的流量收取费用存储空间流出流量请求次数按调用API各种请求的次数收取费用90注：具体资费标准以官网最新公布为准天翼云自研存储产品功能-对象存储-功能•桶管理：创建、删除、查询•对象管理：上传、分段上传...•Browser、Util、FTP•桶标签、对象标签•桶事件通知•桶配额•云存储网关•多版本•分级存储、权限控制、桶策略•对象加密、搜索、压缩•归档存储、低频存储（2022上线）•对象合规保留策略（WORM）...•图片处理：裁剪、水印...•静态网站托管•跨域资源访问•防盗链•服务端加密•小对象聚合•多AZ（Region级备份服务）•http状态码统计、请求信息统计•本地数据/第三方云数据迁移•异步复制对象存储功能91天翼云自研存储产品功能-文件存储-架构应用1应用2应用3VM1VM2VPC1子网1VM3子网2负载均衡VM4VM5VPC2子网3VM6挂载点1挂载点2NAS文件系统92天翼云自研存储产品功能-文件存储-产品能力多功能故障自动迁移，数据可用性

99.95%，持久性

99.99999999%，数据多副本/纠删码存储，集群内秒级故障检测/负载均衡，高可用性远高于传统设计弹性扩展按需弹性扩展，动态扩容安全性具有KMS加密功能，支持本地认证，域用户认证，支持基于VPC的免密认证多共享提供标准的NFSv3/v

4.0和SMB访问协议，支持主流的Linux和Windows操作系统直接挂载灾备能力存储网关高可用，提供文件服务高可用；提供文件远程备份能力高性能最大带宽2GBb/s，单文件系统32T，IOPS20000，时延1-10ms文件存储产品能力93天翼云自研存储产品功能-文件存储-功能•NFSv

3、NFSv

4.

1、CIFS•共享访问•VPC隔离•用户权限管理（2022上线）•多AZ关键能力关键特性•容量配额•KMS加密•文件系统只读•文件绝对路径只读•WORM基础能力•文件系统：创建、在线扩容、续费、冻结、销毁、重命名•快照：创建、删除、列举、重命名、描述修改、查询、回滚94天翼云自研存储产品功能-CSI容器存储-架构DepOps持续交付微服务容器技术业务层传统应用大数据应用PaaS层MySQLRedisMongoDBJenkinsHarborElasticPostgreSQL容器编排层KubernetesOpenShiftRancher存储层CSI-iSCSI统一存储引擎CSI-RBDCSI-NFSCSI-S395天翼云自研存储产品功能-CSI容器存储-产品能力01动态资源：针对K8S的存储资源需求，自动识别/申请/使用/销毁，无须感知，按照K8S标准逻辑使用02多功能：集合多种存储特性于一身，包含RBD/ISCSI/NFS/S3多种存储接入方式03高性能：完美对接后端CStor存储，与高性能网关相互结合。04可靠性：插件自动拉起，弹性伸缩，自动扩容05灾备能力:结合快照/克隆/回滚技术，提供K8S存储的相关灾备能力06持续升级:未来的新技术/新存储接入方式/新特性，随版本滚动升级更新，享受更多存储新功能96天翼云自研存储产品功能-CSI容器存储-功能块存储•云盘挂载和卸载•在线扩容•快照及恢复•容器IO监控•块、裸设备•多可用区感知•跨主机迁移•......•NAS创建、挂载、卸载•SMB挂载卸载•容量控制•在线扩容•动态数据卷-子目录/共享目录•......文件存储•挂载和卸载•数据加密•......对象存储97天翼云自研存储产品功能-云灾备-产品架构服务器虚拟机云下生产中心Region天翼云VPC云主机备份/容灾服务RegionVPC备份/容灾服务云主机Internet•云备份，为云内的云主机、云硬盘、文件服务，云下文件、VMware虚拟化环境，提供简单易用的备份服务，针对病毒入侵、人为误删除、软硬件故障等场景，可将数据恢复到任意备份点。•云容灾，提供跨可用区RPO=0的虚拟机级容灾保护，当生产站点故障时，用户可在容灾站点迅速恢复业务，极大缩短业务中断时间，减少损失。产品架构98天翼云自研存储产品功能-云灾备-产品能力数据可靠产品能力支持云主机多盘、数据库应用级一致性备份；可以跨AZ/Region复制备份，实现异地灾备；支持备份数据自动加密支持常用的备份源，文件/数据库/云数据库/云主机/云硬盘/VMWARE虚拟机等支持备份数据重删/压缩支持数据分析、检索支持一键式自定义备份策略，自动执行，随时按需调整，简单省心；支持一键式容灾切换低成本：客户无需自建容灾机房，省去机房建设及运维等投入，容灾资源按需收费支持全量/增量备份，即时还原，数据安全不丢失，RPO=0，RTO可达分钟级安全高效简单易用多兼容多功能低成本99课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例101存储实验-对象存储实验实验目的：掌握天翼云对象存储的基本使用方法实验一：对象存储自动同步实验实验内容：

1.安装文件系统

2.创建对象存储容器

3.挂载对象存储目录

4.配置目录文件自动同步至对象存储102存储实验-对象存储实验

一、安装对象存储口

1.登录linux云主机，切换到超级管理员模式（我们省略在天翼云管网开通主机的部分）

（1）可以使用SSH公网远程登录、也可以用网页上的远程登录，通常来说使用SSH，我们以root用户登录103存储实验-对象存储实验

一、安装对象存储口

2.安装epel-release命令:yuminstall-yepel-release出现complete！代表安装成功

3.安装s3fs-fuse命令：yum-yinstalls3fs-fuse104存储实验-对象存储实验

二、对象存储首先我们找到对象存储所在控制面板我们可以按照自己的实验环境使用相应的对象存储，在这里我们以经典I版为例。105存储实验-对象存储实验

二、对象存储找到天翼云对象存储的AccessKeyID和AccessSecretKey访问控制的安全凭证面板106存储实验-对象存储实验

二、对象存储以AccessKeyID:AccessSecretKey的格式写入到/etc/passwd-s3fs中

1.命令:echoAccessKeyID:AccessSecretKey>/etc/passwd-s3fs当然也可以使用vim将登录ID和KEY写入到/etc/passwd-s3fs

2.使用more命令查看是否写入成功

3.修改/etc/passwd-s3fs权限为600创建一个目录（可以随意命名）命令:chmod600/etc/passwd-s3fs创建一个目录（test）命令:mkdir/test107存储实验-对象存储实验

三、挂载对象存储你可以自己创建一个新的容器，名称可以随意填写108存储实验-对象存储实验

三、挂载对象存储

1.命令：s3fszhangyu-1/test-opasswd_file=/etc/passwd-s3fs-ourl=http://oos-cn.ctyunapi.cn-oallow_other解析：s3fszhangyu-1（这里替换成你自己创建的容器名称），/test（这是我们刚才创建的目录）

2.查看磁盘是否挂载成功命令:df-h此时可以像正常存储一样使用对象存储了。

3.为了防止重启后挂载丢失，将挂载信息写入/etc/fstab中命令：echo"s3fs#zhangyu-/testfuse_netdev,allow_other,use_path_request_style,url=http://oos-cn.ctyunapi.cn/00">>/etc/fstab重启主机之后执行mount-a即可———————————————109存储实验-对象存储实验

四、配置主机文件自动同步至对象存储

1.安装并启动rsync工具。命令：yum-yinstallrsync；systemctlstartrsyncd.service；systemctlenablersyncd.service

2.设置开机自启动，命令：echo"/usr/bin/rsync--daemon">>/etc/rc.local

3.设置主机目录同步至对象存储命令：rsync-vucrt/你打算备份的目录/*/挂载对象存储的目录/

4.登录对象存储控制台，短暂等待并刷新后可以看到目录文件已经同步110存储实验-容灾备份保护实验目的：掌握天翼云主机备份、云硬盘备份功能的基本使用方法实验二：对象存储实验实验内容：

1.云主机备份

2.云硬盘备份111存储实验-容灾备份保护实验二：云主机和云硬盘备份保护实验目的：掌握天翼云容灾备份常用组件的基本使用方法112存储实验-容灾备份保护

一、云主机备份

1.创建云主机备份库，选择你想备份的主机113

一、云主机备份

2.创建合适的备份存储策略,我们可以选择每天固定时间进行备份,创建完成后绑定并执行。存储实验-容灾备份保护114

二、云硬盘备份

1.创建云硬盘备份库，选择你想备份的主机，方法与云主机备份类似，不再重复。存储实验-容灾备份保护115

三、备份恢复可以在备份控制台中选取备份好的硬盘进行挂载恢复存储实验-容灾备份保护116存储实验-弹性文件备份实验实验目的：掌握天翼云弹性文件存储的使用和利用对象存储自动备份实验三：弹性存储使用和备份实验实验内容：

一、跨AZ的的云主机共用一套弹性文件

二、弹性存储文件自动备份同步至对象存储117存储实验-弹性文件备份实验

一、跨AZ的的云主机共用一套弹性存储

1.申请两条跨AZ的云主机（过程略）

2.申请弹性文件课程目录11存储技术基本概念与演进22存储备份与容灾的基本原理33对象存储与分布式存储44天翼云自研存储产品55天翼云存储实操66存储相关解决方案及案例119对象存储重点场景医疗影像医疗影像安防监控安防监控网络视频网络视频无缝对接PACS系统实现医疗影像数据上云，助力区域医疗影像共享。海量安防监控视频数据上云，降低存储成本，支持智能分析及快速分发。实现媒资库上云存储，支持网络视频内容分发及安全播放。120医疗影像存储场景方案【1/2】场景描述•医疗行业大量依赖各类影像设备做辅助诊断和治疗，产生海量的影像数据；•数据具有绝对私密性，不允许暴露在公网；•医疗影像数据具备科研价值，需要长期持久化保存（15年以上）；•对历史沉积数据的读取调用频次不高；•PACS系统由供应商定制开发，二次开发难度较高，需要尽可能降低迁移难度通用解决方案PACS系统CTMRX光其它医疗专网文件存储对象存储块存储RIS系统HIS系统医疗影像业务云专线媒体存储医院侧天翼云侧121医疗影像存储场景方案【2/2】使用模式产品优势模式一：按医院切入，逐家接入院内PACS，满足院内数据上云需求模式二：按地区切入，接入地区性医疗影像云，满足区域医疗共享需求海量小文件快速读写•满足CT、MR、X光、RIS等多种类型特征的数据存储要求•支持用户侧实现秒级调阅持久稳定•支持两副本、三副本冗余，稳定不易丢失•多可用区备份安全合规•属地化部署，满足数据存本地的合规性要求•专网专线接入，安全可靠医院PACS医院PACS医院PACS媒体存储医院PACS医院PACS医院PACS媒体存储影像云平台122案例-福建省宁德市福鼎医院(模式一)福鼎市医院坐落于闽浙边界的福鼎市中心，是一所综合性三级乙等医院，目前年门诊量100余万人次。该医院是福建省医疗PACS上云试点的首批成员。项目简介解决方案•利用现有平台操作系统自带的SMB协议搭建传输系统，实现现有业务系统零改造；•在医院内网机房部署前置缓存服务器，解决了实际应用中可能出现的抖动延迟问题•在前置缓存服务器部署外挂程序，实现PACS双写，一方面规避了PACS二次改造的成本，另一方面实现了数据的高可用和多重备份，增加了数据存储的安全性。•在院区和存储池之间搭建专线，避免数据公网传输客户需求•不对现有PACS系统进行改造，可实现数据上云的平滑迁移•数据不丢失、应用不卡顿•实现PACS双写，充分利旧现有机房存储资源客户收益•现有平台零改造，一周内即完成了测试、迁移上云的全过程•待全部数据上云后，为客户节省的存储TCO比例约为60%HIS其它系统RISMRCT存储集群对象存储引擎互联网用户院内用户影像科、各科室医生全局负载均衡全局负载均衡医院内网福建存储资源池医疗专线X光PACS接入代理集群文件存储引擎块存储引擎中控集群运维监控用户管理系统管理资源调度计费123案例-某市影像云存储(模式二)HIS其它系统RISMRCT存储集群对象存储引擎互联网用户院内用户影像科、各科室医生全局负载均衡全局负载均衡医院内网X光PACS接入代理集群文件存储引擎块存储引擎中控集群运维监控用户管理系统管理资源调度计费医疗专线使用媒体存储产品建设了存储池，解决了影像云存储的技术痛点：

1、支持影像云平台使用NFS、S3多协议接入。

2、解决影像小文件批量读写的性能瓶颈，并发调阅无卡顿。项目概况影像云平台医疗影像数据全部存储在天翼云媒体存储池。平台覆盖该地区90%的医院，提供面向公众的互联网电子影像服务及各级医疗机构间医疗影像共享服务。成效124安防监控存储场景方案【1/2】场景描述•行业高清化趋势明显，需要海量存储空间•新增和历史积累监控点数目庞大，需要产品能够支持大并发高速率写入•受限于行业规定，部分项目需要私有化部署，视频流专网传输，与公网隔离•项目存储容量可预估•与集成商或设备商关系密切，需要与相应的平台和设备实现兼容•部分项目开始逐步叠加AI分析能力，需要能对接外部AI分析平台，提供大容量读写能力通用解决方案监控设备媒体存储视频编转码CDN分发媒体存储用户APP/PC端/网页端视频上传视频调阅视频分析接入端监控平台视频上传125安防监控存储场景方案【2/2】125关键字

1.海量存储、就近接入、高并发写入、融合AI能力产品优势

1.存储多协议，应用无缝接入。支持NFS、CIFS、iSCSI、S3等多种主流标准存储协议，满足不同客户接入需求。支持块存储、文件存储、对象存储等多种存储形式。

2.属地化建设与服务。存储池节点属地化建设，接入距离近，网络时延低

3.专网接入，确保行业客户数据安全

4.高吞吐，支持多路大媒体文件持续稳定读写

5.具备融合AI能力，支持内容识别、内容审核等应用能力集成126案例--武汉地铁11000路摄像头实时存储，总数据量40PB，带宽需求50G；视频监控分布广泛，分散式存储无法满足集中、实时调阅；对数据存储的安全性(需接入公安专网)、稳定性、可靠性有较高的要求。11000路摄像头实时存储，总数据量40PB，带宽需求50G；视频监控分布广泛，分散式存储无法满足集中、实时调阅；对数据存储的安全性(需接入公安专网)、稳定性、可靠性有较高的要求。通过云专线实现各监控点数据的快速采集、多点汇聚，保证视频数据的稳定、可靠传输；天翼云自主研发视频存储技术，提供高性能、海量云存储平台，实现在线实时扩容；统一监控管理平台实现任何站点视频数据的实时调取查看，满足公安系统对数据实时性、安全性需求。通过云专线实现各监控点数据的快速采集、多点汇聚，保证视频数据的稳定、可靠传输；天翼云自主研发视频存储技术，提供高性能、海量云存储平台，实现在线实时扩容；统一监控管理平台实现任何站点视频数据的实时调取查看，满足公安系统对数据实时性、安全性需求。安全可靠：通过50G超大带宽云专线保证数据传输的可靠性、安全性、实时性；弹性扩容：云存储按需租用，弹性扩容，轻松满足客户短期及长期的大容量存储需求；通过租用云服务，减少上千万的一次性建设费用以及后期硬件运维成本。安全可靠：通过50G超大带宽云专线保证数据传输的可靠性、安全性、实时性；弹性扩容：云存储按需租用，弹性扩容，轻松满足客户短期及长期的大容量存储需求；通过租用云服务，减少上千万的一次性建设费用以及后期硬件运维成本。武汉地铁WUHANMETRO共225座车站，运营里程达334公里，线路长度居中国第五位为了保障“军运会”期间地铁公共交通安全事件的可管、可控，公安部要求本地视频存储周期由30天改为90天，本地存储容量不足，短期内难以扩容共225座车站，运营里程达334公里，线路长度居中国第五位为了保障“军运会”期间地铁公共交通安全事件的可管、可控，公安部要求本地视频存储周期由30天改为90天，本地存储容量不足，短期内难以扩容解决方案客户需求项目效果127案例--金华全球眼项目127存储节点集群存储模块/NRU/BSU管理节点集群千兆带外接入交换机万兆核心交换机千兆带外汇聚交换机路由器专网公网管理网NRU/BSU模块下沉，与存储模块混合部署，单节点即可稳定且高性能接入视频流金华电信全球眼平台现已接入数千路视频流，原存储方案存在稳定性不足的问题。使用媒体存储产品提升多路视频并发读写稳定性。项目简介解决方案客户需求金华电信根据集团智能视频云规划，建设存储云。支持开发区等多个新客户拓展，满足数千路视频接入的潜在需求。128案例--某机场安防监控项目某机场前端摄像头通过国标接入至海康视频云平台上，需要验证该平台与媒体存储产品的兼容性及并发存储性能。项目简介解决方案客户需求采用业内标准的iSCSI或者NFS协议，将云存储通过挂载的方式，加载到视频云平台的流媒体服务器上。从而实现前端摄像头通过视频云平台在天翼云存储上的存储以及回放功能。海康自带异构存储网关桥接于海康视频监控系统私有协议与天翼云存储之间。天翼云云存储采用业内标准的iSCSI或者NFS协议，与海康自带异构存储网关对接。使用103个点位的监控视频并发写入测试再iSCSI和NFS协议下媒体存储产品的稳定性。项目效果•经过为期1周的测试，功能、性能测试均全部通过。•采用标准的iSCSI和NFS协议，均能正常与海康监控平台即插即用式的对接进行，海康应用零改造。•多路并发持续写入稳定正常备份解决方案病毒：7%人为错误：32%应用软件故障：14%自然灾害：3%系统软件故障：44%“数据源是一切关键性业务系统的生命源泉”，数据信息的安全性和可靠性影响企业的生存能力；为避免以上问题造成的数据丢失，建议对企业的核心应用系统，如ERP系统数据库、PDM系统、OA系统数据库等，进行定期的数据备份，并定期进行数据恢复验证测试，确保备份数据的可恢复性129天翼云备份解决方案架构VPC备份服务器ECS备份存储EVSERP财务其他系统······LANA备份软件AAA企业机房EIP/IPSec/专线加密、压缩/重删130天翼云备份解决方案架构特点高安全高安全异地备份，云端9个9持久性云存储，多重数据加密保障核心资产安全低成本低成本无需建设/租赁异地数据中心，免设备运维，数据重删压缩节省带宽与空间易管理易管理云端备份服务器轻松备份云下业务，用户可将精力集中在业务管理上131备份解决方案参考配置备份软件商天翼云备份英方爱数云主机备份云硬盘备份i2CDPAnyBackupECS:8vCPU16GBEVS：根据实际业务量评估存储容量EIP/IPSec/云专线：10MbpsECS:8vCPU16GBEVS：根据实际业务量评估存储容量EIP/IPSec/云专线：10MbpsECS:8vCPU16GBEVS：根据实际业务量评估存储容量EIP/IPSec/云专线：10Mbps备份软件云资源配置备注理论值：10Mbps带宽24小时传输数据量约105GB132感谢聆听！课程开发小组：林志銮、朱伟、刘伟林、张育、顾佩彬、贾水军

